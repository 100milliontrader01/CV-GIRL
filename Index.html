<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quick CV Generator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }

        /* A4 Paper Styling for Preview & Print */
        .a4-page {
            width: 210mm;
            min-height: 297mm;
            background: white;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            margin: 0 auto;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* Print specific adjustments */
        @media print {
            body * {
                visibility: hidden;
            }
            #cv-preview, #cv-preview * {
                visibility: visible;
            }
            #cv-preview {
                position: absolute;
                left: 0;
                top: 0;
                margin: 0;
                box-shadow: none;
                width: 100%;
            }
            .no-print {
                display: none !important;
            }
        }

        /* Typography & Layout for the CV */
        .cv-header {
            padding: 2.5rem 3rem;
            background-color: #1e293b; /* Slate 800 */
            color: white;
        }
        
        .cv-body {
            display: flex;
            flex: 1;
            padding: 2rem 3rem;
            gap: 2rem;
        }

        .cv-main {
            flex: 2; /* 66% width */
            padding-right: 1rem;
            border-right: 1px solid #e2e8f0;
        }

        .cv-sidebar {
            flex: 1; /* 33% width */
            padding-left: 0.5rem;
        }

        .section-title {
            text-transform: uppercase;
            font-size: 0.875rem;
            letter-spacing: 0.1em;
            color: #475569; /* Slate 600 */
            font-weight: 700;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 0.5rem;
            margin-bottom: 1rem;
            margin-top: 2rem;
        }

        .cv-sidebar .section-title {
            color: #0f172a; /* Slate 900 */
            border-color: #cbd5e1;
        }

        .section-title:first-child {
            margin-top: 0;
        }

        /* Content Styling */
        .job-item, .edu-item, .project-item {
            margin-bottom: 1.5rem;
            page-break-inside: avoid;
        }

        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            margin-bottom: 0.25rem;
        }

        .item-title {
            font-weight: 700;
            color: #1e293b;
            font-size: 1.1rem;
        }

        .item-subtitle {
            font-weight: 600;
            color: #475569;
            font-size: 0.95rem;
        }

        .item-date {
            font-size: 0.85rem;
            color: #64748b;
            font-style: italic;
        }

        .item-desc {
            font-size: 0.9rem;
            color: #334155;
            line-height: 1.5;
            margin-top: 0.5rem;
        }

        .skill-tag {
            display: inline-block;
            background: #f1f5f9;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.85rem;
            color: #334155;
            margin-bottom: 0.5rem;
            margin-right: 0.25rem;
        }

        ul.bullet-list {
            list-style-type: disc;
            margin-left: 1rem;
            margin-top: 0.25rem;
        }

        /* Responsive preview container */
        .preview-wrapper {
            transform-origin: top center;
            transition: transform 0.2s;
        }

        /* Input specific styles */
        .input-group label {
            display: block;
            font-size: 0.875rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 0.5rem;
        }
        
        /* Loading Overlay */
        #loader {
            display: none;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- Navbar -->
    <nav class="bg-white border-b border-gray-200 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <span class="text-xl font-bold text-slate-800">CV Builder Pro</span>
                </div>
                <div class="flex items-center space-x-4">
                    <button id="btn-edit" class="hidden text-gray-600 hover:text-gray-900 px-3 py-2 rounded-md text-sm font-medium">
                        Back to Edit
                    </button>
                    <button id="btn-generate" class="bg-slate-800 hover:bg-slate-700 text-white px-4 py-2 rounded-md text-sm font-medium shadow-sm transition">
                        Generate CV
                    </button>
                    <button id="btn-download" class="hidden bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md text-sm font-medium shadow-sm transition flex items-center">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                        Download PDF
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content Area -->
    <main class="flex-grow flex flex-col md:flex-row h-full">
        
        <!-- Input Section -->
        <section id="input-section" class="w-full max-w-4xl mx-auto p-6 md:p-10">
            <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                <div class="mb-6">
                    <h2 class="text-2xl font-bold text-gray-900 mb-2">Enter your Details</h2>
                    <p class="text-gray-500 text-sm">Paste your resume information below. Use the headers provided in the example to help our parser sort your data correctly.</p>
                </div>

                <div class="mb-4 bg-blue-50 text-blue-800 p-4 rounded-md text-sm">
                    <strong>Tip:</strong> Keep headers like "EXPERIENCE", "EDUCATION", and "SKILLS" on their own lines.
                </div>

                <div class="input-group h-96">
                    <textarea id="raw-input" class="w-full h-full p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-slate-500 focus:border-slate-500 font-mono text-sm leading-relaxed" placeholder="Paste your CV content here..."></textarea>
                </div>
            </div>
        </section>

        <!-- Preview Section (Hidden by default) -->
        <section id="preview-section" class="hidden w-full bg-gray-500 overflow-y-auto py-8">
            <div class="flex justify-center">
                <!-- The A4 Page -->
                <div id="cv-preview" class="a4-page">
                    <!-- Header -->
                    <div class="cv-header">
                        <h1 id="p-name" class="text-4xl font-bold mb-2">Your Name</h1>
                        <p id="p-title" class="text-xl text-slate-300 mb-4">Professional Title</p>
                        
                        <div id="p-contact" class="flex flex-wrap gap-4 text-sm text-slate-400">
                            <!-- Contact items injected here -->
                        </div>
                    </div>

                    <div class="cv-body">
                        <!-- Left Main Column -->
                        <div class="cv-main">
                            <div id="p-summary-section" class="mb-6 hidden">
                                <h3 class="section-title">Profile</h3>
                                <p id="p-summary" class="text-sm text-slate-700 leading-relaxed"></p>
                            </div>

                            <div id="p-experience-section">
                                <h3 class="section-title">Experience</h3>
                                <div id="p-experience-list"></div>
                            </div>

                            <div id="p-education-section">
                                <h3 class="section-title">Education</h3>
                                <div id="p-education-list"></div>
                            </div>
                            
                            <div id="p-projects-section">
                                <h3 class="section-title">Projects</h3>
                                <div id="p-projects-list"></div>
                            </div>
                        </div>

                        <!-- Right Sidebar -->
                        <div class="cv-sidebar">
                            <div id="p-skills-section">
                                <h3 class="section-title">Skills</h3>
                                <div id="p-skills-list" class="flex flex-wrap"></div>
                            </div>

                            <div id="p-awards-section" class="mt-8">
                                <h3 class="section-title">Awards</h3>
                                <div id="p-awards-list" class="text-sm text-slate-700 space-y-2"></div>
                            </div>

                            <div id="p-languages-section" class="mt-8">
                                <h3 class="section-title">Languages</h3>
                                <div id="p-languages-list" class="text-sm text-slate-700 space-y-2"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </main>
    
    <!-- Loading Overlay -->
    <div id="loader" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center">
        <div class="bg-white p-5 rounded-lg flex items-center space-x-3">
            <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-slate-900"></div>
            <span>Generating PDF...</span>
        </div>
    </div>

    <script>
        // --- 1. Default Template Data ---
        const DEFAULT_TEMPLATE = `John Doe
Senior Software Engineer
john.doe@email.com | (555) 123-4567 | San Francisco, CA | linkedin.com/in/johndoe

SUMMARY
Experienced software engineer with a passion for building scalable web applications. Proven track record of leadership and technical excellence in full-stack development.

EXPERIENCE
Senior Frontend Developer
Tech Solutions Inc.
2020 - Present
- Led a team of 5 developers to rebuild the core customer dashboard, improving load times by 40%.
- Implemented a new design system using React and Tailwind CSS.
- Mentored junior developers and conducted code reviews.

Web Developer
Creative Agency LLC
2017 - 2020
- Developed responsive websites for high-profile clients including Nike and Apple.
- Collaborated with designers to ensure pixel-perfect implementation of UIs.
- Optimized legacy codebases for better SEO and accessibility.

EDUCATION
Bachelor of Science in Computer Science
University of Technology
2013 - 2017

SKILLS
JavaScript (ES6+), React, Node.js, HTML5, CSS3, Tailwind CSS, Git, Agile, UI/UX Design

PROJECTS
E-commerce Platform
- Built a full-featured e-commerce site with Stripe integration.
- Used Next.js for server-side rendering and improved SEO.

Task Manager App
- Created a productivity tool with real-time updates using Firebase.

AWARDS
Employee of the Year 2021 - Tech Solutions Inc.
Best UI Design 2018 - Web Awards

LANGUAGES
English (Native)
Spanish (Intermediate)
`;

        // --- 2. Element Selectors ---
        const els = {
            inputSection: document.getElementById('input-section'),
            previewSection: document.getElementById('preview-section'),
            rawInput: document.getElementById('raw-input'),
            btnGenerate: document.getElementById('btn-generate'),
            btnEdit: document.getElementById('btn-edit'),
            btnDownload: document.getElementById('btn-download'),
            loader: document.getElementById('loader'),
            // Preview Elements
            pName: document.getElementById('p-name'),
            pTitle: document.getElementById('p-title'),
            pContact: document.getElementById('p-contact'),
            pSummary: document.getElementById('p-summary'),
            pSummarySec: document.getElementById('p-summary-section'),
            pExpList: document.getElementById('p-experience-list'),
            pEduList: document.getElementById('p-education-list'),
            pProjList: document.getElementById('p-projects-list'),
            pSkillsList: document.getElementById('p-skills-list'),
            pAwardsList: document.getElementById('p-awards-list'),
            pLangList: document.getElementById('p-languages-list'),
            // Sections (to hide if empty)
            secExp: document.getElementById('p-experience-section'),
            secEdu: document.getElementById('p-education-section'),
            secProj: document.getElementById('p-projects-section'),
            secSkills: document.getElementById('p-skills-section'),
            secAwards: document.getElementById('p-awards-section'),
            secLang: document.getElementById('p-languages-section'),
        };

        // --- 3. Initialization ---
        els.rawInput.value = DEFAULT_TEMPLATE;

        // --- 4. Logic: Parser ---
        function parseText(text) {
            const sections = {
                header: [],
                summary: [],
                experience: [],
                education: [],
                skills: [],
                projects: [],
                awards: [],
                languages: []
            };

            let currentSection = 'header';
            const lines = text.split('\n');

            // Keywords to identify sections
            const keywords = {
                'SUMMARY': 'summary',
                'PROFILE': 'summary',
                'ABOUT': 'summary',
                'EXPERIENCE': 'experience',
                'WORK HISTORY': 'experience',
                'EMPLOYMENT': 'experience',
                'EDUCATION': 'education',
                'SKILLS': 'skills',
                'TECHNICAL SKILLS': 'skills',
                'PROJECTS': 'projects',
                'AWARDS': 'awards',
                'HONORS': 'awards',
                'LANGUAGES': 'languages',
                'CONTACT': 'header' // Should usually be top, but just in case
            };

            lines.forEach(line => {
                const trimmed = line.trim();
                if (!trimmed) return;

                const upper = trimmed.toUpperCase();
                
                // Check if line is a section header
                if (keywords[upper]) {
                    currentSection = keywords[upper];
                    return;
                }

                sections[currentSection].push(trimmed);
            });

            return sections;
        }

        // --- 5. Logic: Renderer ---
        function renderCV(data) {
            // Header: Name (Line 1), Title (Line 2), Contact (Line 3+)
            if (data.header.length > 0) {
                els.pName.textContent = data.header[0];
                els.pTitle.textContent = data.header[1] || '';
                
                // Process Contact Info (simple pipe or comma separation detection)
                els.pContact.innerHTML = '';
                const contactLines = data.header.slice(2);
                const contactStr = contactLines.join(' | '); // Join multiline contact info
                // Split by | or , to make distinct items
                const contacts = contactStr.split(/[|•]/).map(s => s.trim()).filter(s => s);
                
                contacts.forEach(c => {
                    const span = document.createElement('span');
                    span.textContent = c;
                    els.pContact.appendChild(span);
                });
            }

            // Summary
            if (data.summary.length > 0) {
                els.pSummarySec.classList.remove('hidden');
                els.pSummary.textContent = data.summary.join(' ');
            } else {
                els.pSummarySec.classList.add('hidden');
            }

            // Helper to render complex lists (Exp, Edu, Proj)
            function renderComplexList(items, container, sectionEl) {
                container.innerHTML = '';
                if (!items || items.length === 0) {
                    sectionEl.classList.add('hidden');
                    return;
                }
                sectionEl.classList.remove('hidden');

                // Logic: Groups chunks of text. 
                // Assumption: Title is 1st line, Subtitle/Date 2nd line, rest is description/bullets
                // We need to group lines. A new group starts when we hit a line that looks like a title (not a bullet)
                // However, plain text parsing is hard. 
                // Simplified Strategy: Treat every 3-4 lines as a block, or check for empty lines in input (though split('\n') removes empty lines above).
                
                // Better Strategy for this specific input format:
                // We will iterate and build objects.
                // If a line starts with '-' or '•', it is a bullet of the previous item.
                // If a line is plain text and we just finished a block, it's a new Title.
                
                let jobBlocks = [];
                let currentBlock = null;

                items.forEach((line, index) => {
                    const isBullet = line.startsWith('-') || line.startsWith('•') || line.startsWith('*');
                    
                    if (!currentBlock) {
                        currentBlock = { title: line, subtitle: '', meta: '', desc: [] };
                    } else if (isBullet) {
                        currentBlock.desc.push(line.replace(/^[-•*]\s*/, ''));
                    } else {
                        // It's not a bullet. Is it a subtitle/date or a new Job title?
                        // Heuristic: If currentBlock already has desc, this is likely a NEW job.
                        if (currentBlock.desc.length > 0) {
                            jobBlocks.push(currentBlock);
                            currentBlock = { title: line, subtitle: '', meta: '', desc: [] };
                        } else {
                            // Still populating current block metadata
                            if (!currentBlock.subtitle) currentBlock.subtitle = line;
                            else if (!currentBlock.meta) currentBlock.meta = line;
                            else currentBlock.desc.push(line); // Fallback
                        }
                    }
                });
                if (currentBlock) jobBlocks.push(currentBlock);

                // Render Blocks
                jobBlocks.forEach(job => {
                    const div = document.createElement('div');
                    div.className = 'job-item';
                    
                    let html = `
                        <div class="item-header">
                            <div class="item-title">${job.title}</div>
                        </div>
                    `;
                    
                    if(job.subtitle || job.meta) {
                        html += `<div class="flex justify-between items-baseline mb-2">
                            <div class="item-subtitle">${job.subtitle}</div>
                            <div class="item-date">${job.meta}</div>
                        </div>`;
                    }

                    if (job.desc.length > 0) {
                        html += `<ul class="bullet-list text-sm text-slate-700 leading-relaxed">`;
                        job.desc.forEach(d => html += `<li>${d}</li>`);
                        html += `</ul>`;
                    }

                    div.innerHTML = html;
                    container.appendChild(div);
                });
            }

            // Experience
            renderComplexList(data.experience, els.pExpList, els.secExp);
            
            // Education (Reuse complex list, or simplify)
            // Education usually: Degree, School, Year.
            renderComplexList(data.education, els.pEduList, els.secEdu);

            // Projects
            renderComplexList(data.projects, els.pProjList, els.secProj);

            // Skills (Comma separated or new lines)
            els.pSkillsList.innerHTML = '';
            if (data.skills.length > 0) {
                els.secSkills.classList.remove('hidden');
                const rawSkills = data.skills.join(','); 
                const skillItems = rawSkills.split(/[,|•]/).map(s => s.trim()).filter(s => s);
                skillItems.forEach(s => {
                    const tag = document.createElement('span');
                    tag.className = 'skill-tag';
                    tag.textContent = s;
                    els.pSkillsList.appendChild(tag);
                });
            } else {
                els.secSkills.classList.add('hidden');
            }

            // Awards
            els.pAwardsList.innerHTML = '';
            if (data.awards.length > 0) {
                els.secAwards.classList.remove('hidden');
                data.awards.forEach(a => {
                    const div = document.createElement('div');
                    div.textContent = a.replace(/^[-•*]\s*/, '');
                    els.pAwardsList.appendChild(div);
                });
            } else {
                els.secAwards.classList.add('hidden');
            }

            // Languages
            els.pLangList.innerHTML = '';
            if (data.languages.length > 0) {
                els.secLang.classList.remove('hidden');
                data.languages.forEach(l => {
                    const div = document.createElement('div');
                    div.textContent = l.replace(/^[-•*]\s*/, '');
                    els.pLangList.appendChild(div);
                });
            } else {
                els.secLang.classList.add('hidden');
            }
        }

        // --- 6. Event Listeners ---

        els.btnGenerate.addEventListener('click', () => {
            const text = els.rawInput.value;
            if(!text.trim()) {
                alert("Please enter some text!");
                return;
            }

            const parsedData = parseText(text);
            renderCV(parsedData);

            // Switch Views
            els.inputSection.classList.add('hidden');
            els.previewSection.classList.remove('hidden');
            
            // Toggle Buttons
            els.btnGenerate.classList.add('hidden');
            els.btnEdit.classList.remove('hidden');
            els.btnDownload.classList.remove('hidden');
        });

        els.btnEdit.addEventListener('click', () => {
            els.previewSection.classList.add('hidden');
            els.inputSection.classList.remove('hidden');
            
            els.btnEdit.classList.add('hidden');
            els.btnDownload.classList.add('hidden');
            els.btnGenerate.classList.remove('hidden');
        });

        els.btnDownload.addEventListener('click', () => {
            const element = document.getElementById('cv-preview');
            const name = els.pName.textContent || 'resume';
            
            // Show Loader
            els.loader.style.display = 'flex';

            const opt = {
                margin: 0,
                filename: `${name.replace(/\s+/g, '_').toLowerCase()}_cv.pdf`,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2, useCORS: true },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };

            // Wait a slight moment for DOM to settle if needed, then print
            setTimeout(() => {
                html2pdf().set(opt).from(element).save().then(() => {
                    els.loader.style.display = 'none';
                });
            }, 100);
        });

    </script>
</body>
</html>
